<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spell & Learn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;font-family:Arial,sans-serif;background:#cfe9ff}
canvas{display:block;touch-action:none}

.topbar{
  position:fixed;top:0;left:0;right:0;height:70px;
  background:#ffffffee;display:flex;align-items:center;
  justify-content:space-between;padding:0 12px;z-index:10
}
.btn{
  background:#4caf50;color:#fff;border:none;
  border-radius:14px;padding:10px 14px;font-size:16px;
  margin:4px;
}
.btn-outline{
  background:#fff;color:#333;border:2px solid #4caf50;
}
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.45);
  display:flex;align-items:center;justify-content:center;z-index:20
}
.card{
  background:#fff;border-radius:24px;
  padding:24px;width:90%;max-width:380px;text-align:center
}
input{
  width:90%;
  padding:10px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
  margin:10px 0;
  text-align:center;
}
.hidden{display:none}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar hidden" id="gameTopbar">
  <div style="font-size:18px">‚≠ê <span id="stars">0</span></div>
  <button class="btn" onclick="location.reload()">üè† Home</button>
</div>

<canvas id="c" class="hidden"></canvas>

<!-- HOME -->
<div class="overlay" id="home">
  <div class="card">
    <h2>Spell & Learn üê±</h2>
    <input id="nameInput" placeholder="Enter name (optional)">
    <button class="btn" onclick="saveName()">Save Name</button>
    <p id="greet"></p>
    <hr>
    <p>Select mode (temporary)</p>
    <button class="btn btn-outline" onclick="selectMode('Any')">Any</button>
    <p id="modeText"></p>
    <button class="btn" style="font-size:20px" onclick="startGame()">‚ñ∂Ô∏è Play</button>
  </div>
</div>

<script>
/* ================= CANVAS ================= */
const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

/* ================= STATE ================= */
const STORE="spellLearnBridge";
let name="",mode="Any";
let stars=0;
let wordIndex=0,letterIndex=0;
let collecting=false,collisionEnabled=true;

const words=["CAT","DOG","COW","PIG","HEN","DUCK","GOAT","LION","BEAR","APPLE"];
const emojis={CAT:"üê±",DOG:"üê∂",COW:"üêÑ",PIG:"üê∑",HEN:"üêî",DUCK:"ü¶Ü",
GOAT:"üêê",LION:"ü¶Å",BEAR:"üêª",APPLE:"üçé"};

const player={x:200,y:300};
const letter={x:100,y:200,char:"",vx:.6,vy:.5,float:0};

/* ================= HOME ================= */
function saveName(){
  name=document.getElementById("nameInput").value.trim();
  localStorage.setItem(STORE,JSON.stringify({name,mode,stars}));
  document.getElementById("greet").textContent=name?`Hi ${name}!`:"";
}
function selectMode(m){
  mode=m;
  document.getElementById("modeText").textContent="Selected: "+m;
}

/* ================= GAME ================= */
function startGame(){
  document.getElementById("home").style.display="none";
  document.getElementById("gameTopbar").classList.remove("hidden");
  canvas.classList.remove("hidden");
  spawn();
  draw();
}

/* ================= SPEECH ================= */
function speak(t){
  if(!speechSynthesis)return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(t);
  u.rate=.6;
  speechSynthesis.speak(u);
}

/* ================= SPAWN ================= */
function spawn(){
  collecting=false;collisionEnabled=false;
  letter.char=words[wordIndex][letterIndex];
  let safe=false;
  while(!safe){
    letter.x=Math.random()*(canvas.width-140)+40;
    letter.y=Math.random()*(canvas.height-260)+120;
    const dx=(player.x)-(letter.x+60);
    const dy=(player.y)-(letter.y+60);
    safe=Math.hypot(dx,dy)>180;
  }
  setTimeout(()=>collisionEnabled=true,300);
}

/* ================= COLLECT ================= */
canvas.addEventListener("click",e=>{
  if(!collisionEnabled)return;
  const dx=e.clientX-(letter.x+60);
  const dy=e.clientY-(letter.y+60);
  if(Math.hypot(dx,dy)<60) collect();
});

function collect(){
  if(collecting)return;
  collecting=true;collisionEnabled=false;
  speak(letter.char);
  letterIndex++;
  if(letterIndex<words[wordIndex].length){
    setTimeout(spawn,300);
  }else{
    stars++;
    document.getElementById("stars").textContent=stars;
    setTimeout(()=>speak(words[wordIndex]),700);
    setTimeout(()=>{
      wordIndex=(wordIndex+1)%words.length;
      letterIndex=0;
      spawn();
    },1200);
  }
}

/* ================= DRAW ================= */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#fff";
  ctx.font="28px Arial";
  ctx.textAlign="center";
  let line="";
  for(let i=0;i<words[wordIndex].length;i++){
    line+=i<letterIndex?words[wordIndex][i]+" ":"‚Ä¢ ";
  }
  ctx.fillText(line.trim(),canvas.width/2,100);

  letter.float+=.03;
  letter.x+=letter.vx;
  letter.y+=letter.vy+Math.sin(letter.float)*.3;
  if(letter.x<0||letter.x>canvas.width-120)letter.vx*=-1;
  if(letter.y<120||letter.y>canvas.height-120)letter.vy*=-1;

  ctx.beginPath();
  ctx.arc(letter.x+60,letter.y+60,55,0,Math.PI*2);
  ctx.fillStyle="#ff7043";
  ctx.fill();
  ctx.fillStyle="#fff";
  ctx.font="bold 72px Arial";
  ctx.fillText(letter.char,letter.x+60,letter.y+78);

  ctx.font="72px Arial";
  ctx.fillText("üê±",player.x,player.y);

  if(collisionEnabled){
    const dx=(player.x)-(letter.x+60);
    const dy=(player.y)-(letter.y+60);
    if(Math.hypot(dx,dy)<90) collect();
  }
  requestAnimationFrame(draw);
}
</script>

</body>
</html>
