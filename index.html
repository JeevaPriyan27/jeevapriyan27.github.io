<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Spell & Learn</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;overflow:hidden;font-family:Arial,sans-serif;background:#cfe9ff}
canvas{display:block;touch-action:none}

.topbar{
  position:fixed;top:0;left:0;right:0;height:70px;
  background:#ffffffee;display:flex;align-items:center;
  justify-content:space-between;padding:0 12px;z-index:10
}
.btn{
  background:#4caf50;color:#fff;border:none;
  border-radius:14px;padding:10px 14px;font-size:16px;margin:4px
}
.btn-outline{
  background:#fff;color:#333;border:2px solid #4caf50
}
.overlay{
  position:fixed;inset:0;background:rgba(0,0,0,.45);
  display:flex;align-items:center;justify-content:center;z-index:20
}
.card{
  background:#fff;border-radius:24px;
  padding:24px;width:92%;max-width:420px;text-align:center
}
input{
  width:90%;padding:10px;font-size:18px;
  border-radius:10px;border:1px solid #ccc;
  margin:8px 0;text-align:center
}
.hidden{display:none}
.stickers{
  display:grid;grid-template-columns:repeat(2,1fr);
  gap:12px;margin:12px 0
}
</style>
</head>

<body>

<!-- TOP BAR (GAME) -->
<div class="topbar hidden" id="gameTop">
  <div>ğŸ‘¤ <span id="playerName"></span></div>
  <div>â­ <span id="stars">0</span></div>
  <div>
    <button class="btn btn-outline" onclick="showHome()">ğŸ  Home</button>
    <button class="btn btn-outline" onclick="openStickers()">ğŸ“˜ Stickers</button>
    <button class="btn btn-outline" onclick="openReset()">ğŸ”„ Reset</button>
  </div>
</div>

<canvas id="c" class="hidden"></canvas>

<!-- HOME -->
<div class="overlay" id="home">
  <div class="card">
    <h2>Spell & Learn ğŸ±</h2>
    <input id="nameInput" placeholder="Enter name (optional)">
    <button class="btn" onclick="saveName()">Save Name</button>
    <p id="greet"></p>

    <hr>
    <p><b>Select category</b></p>
    <div>
      <button class="btn btn-outline" onclick="selectMode('Animals')">ğŸ¶ Animals</button>
      <button class="btn btn-outline" onclick="selectMode('Food')">ğŸ Food</button>
      <button class="btn btn-outline" onclick="selectMode('Vehicles')">ğŸš— Vehicles</button>
      <button class="btn btn-outline" onclick="selectMode('Nature')">ğŸŒ¿ Nature</button>
      <button class="btn btn-outline" onclick="selectMode('Home')">ğŸ  Home</button>
      <button class="btn btn-outline" onclick="selectMode('Random')">ğŸ² Random</button>
    </div>

    <p id="modeText"></p>
    <button class="btn" style="font-size:20px" onclick="startGame()">â–¶ï¸ Play</button>
  </div>
</div>

<!-- WORD COMPLETE -->
<div class="overlay hidden" id="popup">
  <div class="card">
    <div id="popupEmoji" style="font-size:90px">ğŸ‰</div>
    <div id="popupWord" style="font-size:36px;font-weight:bold"></div>
    <button class="btn" onclick="closePopup()">OK</button>
  </div>
</div>

<!-- STICKERS -->
<div class="overlay hidden" id="stickerPanel">
  <div class="card">
    <h3>Sticker Book</h3>
    <p>â­ 100 stars = 1 sticker</p>
    <div class="stickers" id="stickerGrid"></div>
    <button class="btn" onclick="stickerPanel.classList.add('hidden')">Close</button>
  </div>
</div>

<!-- RESET -->
<div class="overlay hidden" id="resetPanel">
  <div class="card">
    <h3>Reset Progress</h3>
    <p>Type this word to confirm:</p>
    <div id="resetWord" style="font-size:28px;font-weight:bold"></div>
    <input id="resetInput">
    <button class="btn" onclick="resetPanel.classList.add('hidden')">Cancel</button>
    <button class="btn" id="confirmReset" disabled>Confirm</button>
  </div>
</div>

<script>
/* ================= DATA ================= */
const categories={
Animals:["CAT","DOG","COW","PIG","HEN","DUCK","GOAT","LION","TIGER","BEAR","HORSE","SHEEP","MONKEY","ELEPHANT","DEER","FROG","FISH","BIRD","MOUSE","CAMEL"],
Food:["APPLE","BANANA","MANGO","ORANGE","GRAPE","PEAR","PEACH","PLUM","MILK","BREAD","EGG","CAKE","RICE","CORN","HONEY","JUICE","COOKIE","CHEESE","BUTTER","SANDWICH"],
Vehicles:["CAR","BUS","VAN","BIKE","TRAIN","TRUCK","SHIP","PLANE","SCOOTER","TRACTOR","TAXI","JEEP","METRO","BOAT","HELICOPTER","AMBULANCE","POLICE","FIRETRUCK","CYCLE","AUTO"],
Nature:["SUN","MOON","STAR","TREE","RAIN","SNOW","CLOUD","FLOWER","LEAF","GRASS","RIVER","HILL","MOUNTAIN","BEACH","FOREST","WIND","STORM","SKY","SOIL","ROCK"],
Home:["BALL","BOOK","PEN","CUP","HAT","BAG","BOX","CHAIR","TABLE","BED","DOOR","KEY","PHONE","CLOCK","SHOE","SPOON","PLATE","BOTTLE","PILLOW","LAMP"]
};

const emojis={CAT:"ğŸ±",DOG:"ğŸ¶",COW:"ğŸ„",PIG:"ğŸ·",HEN:"ğŸ”",DUCK:"ğŸ¦†",GOAT:"ğŸ",LION:"ğŸ¦",
TIGER:"ğŸ¯",BEAR:"ğŸ»",HORSE:"ğŸ´",SHEEP:"ğŸ‘",MONKEY:"ğŸµ",ELEPHANT:"ğŸ˜",DEER:"ğŸ¦Œ",
FROG:"ğŸ¸",FISH:"ğŸŸ",BIRD:"ğŸ¦",MOUSE:"ğŸ­",CAMEL:"ğŸª",APPLE:"ğŸ",BANANA:"ğŸŒ",
MANGO:"ğŸ¥­",ORANGE:"ğŸŠ",GRAPE:"ğŸ‡",MILK:"ğŸ¥›",BREAD:"ğŸ",EGG:"ğŸ¥š",CAKE:"ğŸ°",
CAR:"ğŸš—",BUS:"ğŸšŒ",TRAIN:"ğŸš†",PLANE:"âœˆï¸",BOAT:"ğŸš¤",SUN:"â˜€ï¸",MOON:"ğŸŒ™",
STAR:"â­",TREE:"ğŸŒ³",FLOWER:"ğŸŒ¸"};

const stickers=["Dog.png","Apple.png","Car.png","Flower.png"];
const STORE="spellLearnPhase2";

/* ================= STATE ================= */
let profile={name:"",stars:0,mode:"Animals"};
let words=[],wordIndex=0,letterIndex=0;
let collecting=false,collision=true;

const canvas=document.getElementById("c");
const ctx=canvas.getContext("2d");
const player={x:200,y:300};
const letter={x:100,y:200,char:"",vx:.6,vy:.5,float:0};
const bg=new Image();bg.src="bg.png";

/* ================= INIT ================= */
function resize(){canvas.width=innerWidth;canvas.height=innerHeight}
resize();addEventListener("resize",resize);

loadProfile();
updateHome();

/* ================= PROFILE ================= */
function loadProfile(){
  try{
    const d=JSON.parse(localStorage.getItem(STORE));
    if(d) profile=d;
  }catch{}
}
function saveProfile(){
  localStorage.setItem(STORE,JSON.stringify(profile));
}
function saveName(){
  const v=nameInput.value.trim();
  if(v) profile.name=v.substring(0,10);
  saveProfile();updateHome();
}
function selectMode(m){
  profile.mode=m;saveProfile();updateHome();
}
function updateHome(){
  greet.textContent=profile.name?`Hi, ${profile.name}!`:"";
  nameInput.value=profile.name||"";
  modeText.textContent="Selected: "+profile.mode;
}

/* ================= NAV ================= */
function startGame(){
  home.style.display="none";
  gameTop.classList.remove("hidden");
  canvas.classList.remove("hidden");
  playerName.textContent=profile.name||"Player";
  stars.textContent=profile.stars;
  setupWords();
  spawn();
  draw();
}
function showHome(){
  home.style.display="flex";
}

/* ================= WORD SET ================= */
function setupWords(){
  if(profile.mode==="Random"){
    words=[].concat(...Object.values(categories));
    words.sort(()=>Math.random()-.5);
  }else{
    words=[...categories[profile.mode]];
  }
  wordIndex=0;letterIndex=0;
}

/* ================= SPEECH ================= */
function speak(t){
  if(!speechSynthesis)return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(t);
  u.rate=.6;speechSynthesis.speak(u);
}

/* ================= GAME ================= */
function spawn(){
  collecting=false;collision=false;
  letter.char=words[wordIndex][letterIndex];
  let safe=false;
  while(!safe){
    letter.x=Math.random()*(canvas.width-140)+40;
    letter.y=Math.random()*(canvas.height-260)+120;
    const dx=player.x-(letter.x+60);
    const dy=player.y-(letter.y+60);
    safe=Math.hypot(dx,dy)>180;
  }
  setTimeout(()=>collision=true,300);
}

canvas.addEventListener("click",e=>{
  if(!collision)return;
  const dx=e.clientX-(letter.x+60);
  const dy=e.clientY-(letter.y+60);
  if(Math.hypot(dx,dy)<60) collect();
});

function collect(){
  if(collecting)return;
  collecting=true;collision=false;
  speak(letter.char);
  letterIndex++;
  if(letterIndex<words[wordIndex].length){
    setTimeout(spawn,300);
  }else{
    profile.stars++;saveProfile();
    stars.textContent=profile.stars;
    setTimeout(()=>speak(words[wordIndex]),700);
    setTimeout(()=>{
      popupEmoji.textContent=emojis[words[wordIndex]]||"ğŸ‰";
      popupWord.textContent=words[wordIndex];
      popup.classList.remove("hidden");
    },1200);
  }
}

function closePopup(){
  popup.classList.add("hidden");
  wordIndex=(wordIndex+1)%words.length;
  letterIndex=0;
  spawn();
}

/* ================= STICKERS ================= */
function openStickers(){
  stickerPanel.classList.remove("hidden");
  stickerGrid.innerHTML="";
  const unlocked=Math.floor(profile.stars/100);
  stickers.forEach((s,i)=>{
    const img=document.createElement("img");
    img.src=s;img.style.width="100%";
    img.style.opacity=i<unlocked?1:.15;
    img.style.filter=i<unlocked?"none":"grayscale(100%)";
    stickerGrid.appendChild(img);
  });
}

/* ================= RESET ================= */
function openReset(){
  resetWord.textContent=words[Math.floor(Math.random()*words.length)];
  resetInput.value="";
  confirmReset.disabled=true;
  resetPanel.classList.remove("hidden");
}
resetInput.oninput=()=>{
  confirmReset.disabled=resetInput.value.toUpperCase()!==resetWord.textContent;
};
confirmReset.onclick=()=>{
  localStorage.removeItem(STORE);
  location.reload();
};

/* ================= DRAW ================= */
function draw(){
  bg.complete?ctx.drawImage(bg,0,0,canvas.width,canvas.height):
  ctx.clearRect(0,0,canvas.width,canvas.height);

  ctx.fillStyle="#fff";
  ctx.font="28px Arial";ctx.textAlign="center";
  let line="";
  for(let i=0;i<words[wordIndex].length;i++){
    line+=i<letterIndex?words[wordIndex][i]+" ":"â€¢ ";
  }
  ctx.fillText(line.trim(),canvas.width/2,110);

  letter.float+=.03;
  letter.x+=letter.vx;
  letter.y+=letter.vy+Math.sin(letter.float)*.3;
  if(letter.x<0||letter.x>canvas.width-120)letter.vx*=-1;
  if(letter.y<120||letter.y>canvas.height-120)letter.vy*=-1;

  ctx.beginPath();
  ctx.arc(letter.x+60,letter.y+60,55,0,Math.PI*2);
  ctx.fillStyle="#ff7043";ctx.fill();
  ctx.fillStyle="#fff";ctx.font="bold 72px Arial";
  ctx.fillText(letter.char,letter.x+60,letter.y+78);

  ctx.font="72px Arial";
  ctx.fillText("ğŸ±",player.x,player.y);

  if(collision){
    const dx=player.x-(letter.x+60);
    const dy=player.y-(letter.y+60);
    if(Math.hypot(dx,dy)<90) collect();
  }
  requestAnimationFrame(draw);
}
</script>

</body>
</html>
